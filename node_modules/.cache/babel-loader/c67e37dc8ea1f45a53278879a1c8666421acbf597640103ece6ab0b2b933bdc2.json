{"ast":null,"code":"var _jsxFileName = \"/home/splee/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/react-pizza/src/pages/Home.tsx\",\n  _s = $RefreshSig$();\nimport React from 'react';\nimport { Categories, Sort, PizzaBlock, Skeleton, Pagination } from '../components';\nimport { useSelector } from 'react-redux';\nimport { setCategoryId, setSortType, setFilters } from '../redux/filter/slice';\nimport { selectFilter } from '../redux/filter/selectors';\nimport qs from 'qs';\nimport { useNavigate } from 'react-router-dom';\nimport { fetchPizza } from '../redux/pizza/asyncActions';\nimport { selectPizzaData } from '../redux/pizza/selectors';\nimport { useAppDispatch } from '../redux/store';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Home = () => {\n  _s();\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n  const isSearch = React.useRef(false);\n  const onChangeCategory = React.useCallback(idx => {\n    dispatch(setCategoryId(idx));\n    // eslint-disable-next-line\n  }, []);\n\n  // eslint-disable-next-line\n  const onChangeSort = React.useCallback(id => {\n    dispatch(setSortType(id));\n  }, []);\n  const {\n    categoryId,\n    sort,\n    currentPage,\n    pagesCount,\n    searchValue\n  } = useSelector(selectFilter);\n  const {\n    items,\n    status\n  } = useSelector(selectPizzaData);\n  const isMounted = React.useRef(false);\n  const getPizzas = async () => {\n    try {\n      dispatch(fetchPizza({\n        currentPage,\n        sort,\n        categoryId\n      }));\n      window.scrollTo(0, 0);\n    } catch (err) {\n      throw new Error('Ошибка при загрузке API');\n    }\n  };\n  React.useEffect(() => {\n    if (isMounted.current) {\n      if (categoryId !== 0) {\n        const queryString = qs.stringify({\n          categoryId,\n          currentPage\n        });\n        navigate(`?${queryString}`);\n      } else {\n        navigate('');\n      }\n    }\n    isMounted.current = true;\n    // eslint-disable-next-line\n  }, [categoryId, currentPage]);\n  React.useEffect(() => {\n    if (window.location.search) {\n      const params = qs.parse(window.location.search.substring(1));\n      dispatch(setFilters({\n        categoryId: Number(params.categoryId),\n        currentPage: Number(params.currentPage)\n      }));\n      isMounted.current = true;\n    }\n  }, []);\n  React.useEffect(() => {\n    window.scrollTo(0, 0);\n    if (!isSearch.current) {\n      getPizzas();\n    }\n    if (window.location.search === '') {\n      dispatch(setCategoryId(0));\n    }\n    isSearch.current = false;\n  }, [categoryId, sort.sortProperty, currentPage, window.location.search]);\n  const pizzas = items.filter(obj => {\n    if (obj.title.toLowerCase().includes(searchValue.toLowerCase())) {\n      return true;\n    }\n    ;\n    return false;\n  }).map(obj => /*#__PURE__*/_jsxDEV(PizzaBlock, {\n    ...obj\n  }, obj.id, false, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 30\n  }, this));\n  const skeletons = [...new Array(currentPage === 3 ? 2 : 4)].map((_, i) => /*#__PURE__*/_jsxDEV(Skeleton, {}, i, false, {\n    fileName: _jsxFileName,\n    lineNumber: 106,\n    columnNumber: 77\n  }, this));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__top\",\n      children: [/*#__PURE__*/_jsxDEV(Categories, {\n        value: categoryId,\n        onChangeCategory: onChangeCategory\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Sort, {\n        value: sort,\n        onChangeSort: onChangeSort\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"content__title\",\n      children: \"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this), status === 'error' ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__error-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: [\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430\", /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\uD83D\\uDE15\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 31\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E, \\u043D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u043F\\u0438\\u0446\\u0446\\u044B.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 53\n        }, this), \"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__items\",\n      children: status === 'loading' ? skeletons : pizzas\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Pagination, {\n      pageCount: pagesCount,\n      currentPage: currentPage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 5\n  }, this);\n};\n_s(Home, \"49walGrw7uRB4fscWHqeMerVHSI=\", false, function () {\n  return [useNavigate, useAppDispatch, useSelector, useSelector];\n});\n_c = Home;\nvar _c;\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"names":["React","Categories","Sort","PizzaBlock","Skeleton","Pagination","useSelector","setCategoryId","setSortType","setFilters","selectFilter","qs","useNavigate","fetchPizza","selectPizzaData","useAppDispatch","jsxDEV","_jsxDEV","Home","_s","navigate","dispatch","isSearch","useRef","onChangeCategory","useCallback","idx","onChangeSort","id","categoryId","sort","currentPage","pagesCount","searchValue","items","status","isMounted","getPizzas","window","scrollTo","err","Error","useEffect","current","queryString","stringify","location","search","params","parse","substring","Number","sortProperty","pizzas","filter","obj","title","toLowerCase","includes","map","fileName","_jsxFileName","lineNumber","columnNumber","skeletons","Array","_","i","className","children","value","pageCount","_c","$RefreshReg$"],"sources":["/home/splee/Документы/react-pizza/src/pages/Home.tsx"],"sourcesContent":["import React from 'react';\nimport { Categories, Sort, PizzaBlock, Skeleton, Pagination } from '../components';\nimport { useSelector } from 'react-redux';\nimport { setCategoryId, setSortType, setFilters } from '../redux/filter/slice';\nimport { selectFilter } from '../redux/filter/selectors'\nimport { SearchPizzaParams } from '../redux/filter/types'\nimport qs from 'qs'\nimport { useNavigate } from 'react-router-dom';\nimport { fetchPizza } from '../redux/pizza/asyncActions';\nimport { selectPizzaData } from '../redux/pizza/selectors';\nimport { useAppDispatch } from '../redux/store';\n\nexport type ItemProps = {\n  id: string,\n  title: string,\n  price: number,\n  imageUrl: string,\n  sizes: number[],\n  types: number[]\n}\n\nexport const Home: React.FC = () => {\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n  const isSearch = React.useRef(false);\n\n  const onChangeCategory = React.useCallback((idx: number) => {\n    dispatch(setCategoryId(idx))\n    // eslint-disable-next-line\n  }, [])\n\n  // eslint-disable-next-line\n  const onChangeSort = React.useCallback((id: { name: string, sortProperty: string }) => {\n    dispatch(setSortType(id))\n  }, [])\n\n  const { categoryId, sort, currentPage, pagesCount, searchValue } = useSelector(selectFilter);\n  const { items, status } = useSelector(selectPizzaData);\n  const isMounted = React.useRef(false)\n\n  const getPizzas = async () => {\n    try {\n      dispatch(\n        fetchPizza({\n        currentPage,\n        sort,\n        categoryId\n      }))\n      window.scrollTo(0, 0);\n    } catch (err) {\n      throw new Error('Ошибка при загрузке API');\n    }\n  }\n\n  React.useEffect(() => {    \n    if (isMounted.current) {\n      if (categoryId !== 0) {\n        const queryString = qs.stringify({\n          categoryId,\n          currentPage\n        });\n        navigate(`?${queryString}`);\n      } else {\n        navigate('')\n      }\n    }\n\n    isMounted.current = true\n  // eslint-disable-next-line\n  }, [categoryId, currentPage]);\n\n  React.useEffect(() => {\n    if (window.location.search) {\n      const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzaParams;\n\n      dispatch(setFilters({\n        categoryId: Number(params.categoryId),\n        currentPage: Number(params.currentPage)\n      }));\n\n      isMounted.current = true;\n    }\n  }, []);\n\n  React.useEffect(() => {\n    window.scrollTo(0, 0);    \n    if (!isSearch.current) {\n      getPizzas();\n    }\n\n    if (window.location.search === '') {\n      dispatch(setCategoryId(0))\n    }\n\n    isSearch.current = false;\n  }, [categoryId, sort.sortProperty, currentPage, window.location.search]);\n\n  const pizzas = items.filter((obj: ItemProps) => {\n    if (obj.title.toLowerCase().includes(searchValue.toLowerCase())) {\n      return true;\n    };\n\n    return false;\n  }).map((obj: ItemProps) => <PizzaBlock key={obj.id} {...obj} />);\n  \n  const skeletons = [...new Array(currentPage === 3 ? 2 : 4)].map((_, i) => <Skeleton key={i} />);  \n\n  return (\n    <div className='container'>\n      <div className=\"content__top\">\n        <Categories value = {categoryId} onChangeCategory={onChangeCategory} />\n        <Sort value = {sort} onChangeSort = {onChangeSort} />\n      </div>\n      <h2 className=\"content__title\">Все пиццы</h2>\n      {status === 'error' ? (\n        <div className='content__error-info'>\n          <h2>Произошла ошибка<span>😕</span></h2>\n          <p>\n            К сожалению, не удалось загрузить пиццы.<br />\n            Попробуйте повторить попытку позже.\n          </p>\n        </div>\n      ) : (\n        <div className=\"content__items\">\n          {status === 'loading' ? skeletons : pizzas}\n        </div>\n      )}\n      <Pagination pageCount={pagesCount} currentPage={currentPage} />\n    </div>\n  )\n}\n"],"mappings":";;AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,UAAU,EAAEC,IAAI,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,UAAU,QAAQ,eAAe;AAClF,SAASC,WAAW,QAAQ,aAAa;AACzC,SAASC,aAAa,EAAEC,WAAW,EAAEC,UAAU,QAAQ,uBAAuB;AAC9E,SAASC,YAAY,QAAQ,2BAA2B;AAExD,OAAOC,EAAE,MAAM,IAAI;AACnB,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,UAAU,QAAQ,6BAA6B;AACxD,SAASC,eAAe,QAAQ,0BAA0B;AAC1D,SAASC,cAAc,QAAQ,gBAAgB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAWhD,OAAO,MAAMC,IAAc,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAClC,MAAMC,QAAQ,GAAGR,WAAW,CAAC,CAAC;EAC9B,MAAMS,QAAQ,GAAGN,cAAc,CAAC,CAAC;EACjC,MAAMO,QAAQ,GAAGtB,KAAK,CAACuB,MAAM,CAAC,KAAK,CAAC;EAEpC,MAAMC,gBAAgB,GAAGxB,KAAK,CAACyB,WAAW,CAAEC,GAAW,IAAK;IAC1DL,QAAQ,CAACd,aAAa,CAACmB,GAAG,CAAC,CAAC;IAC5B;EACF,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMC,YAAY,GAAG3B,KAAK,CAACyB,WAAW,CAAEG,EAA0C,IAAK;IACrFP,QAAQ,CAACb,WAAW,CAACoB,EAAE,CAAC,CAAC;EAC3B,CAAC,EAAE,EAAE,CAAC;EAEN,MAAM;IAAEC,UAAU;IAAEC,IAAI;IAAEC,WAAW;IAAEC,UAAU;IAAEC;EAAY,CAAC,GAAG3B,WAAW,CAACI,YAAY,CAAC;EAC5F,MAAM;IAAEwB,KAAK;IAAEC;EAAO,CAAC,GAAG7B,WAAW,CAACQ,eAAe,CAAC;EACtD,MAAMsB,SAAS,GAAGpC,KAAK,CAACuB,MAAM,CAAC,KAAK,CAAC;EAErC,MAAMc,SAAS,GAAG,MAAAA,CAAA,KAAY;IAC5B,IAAI;MACFhB,QAAQ,CACNR,UAAU,CAAC;QACXkB,WAAW;QACXD,IAAI;QACJD;MACF,CAAC,CAAC,CAAC;MACHS,MAAM,CAACC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC;IACvB,CAAC,CAAC,OAAOC,GAAG,EAAE;MACZ,MAAM,IAAIC,KAAK,CAAC,yBAAyB,CAAC;IAC5C;EACF,CAAC;EAEDzC,KAAK,CAAC0C,SAAS,CAAC,MAAM;IACpB,IAAIN,SAAS,CAACO,OAAO,EAAE;MACrB,IAAId,UAAU,KAAK,CAAC,EAAE;QACpB,MAAMe,WAAW,GAAGjC,EAAE,CAACkC,SAAS,CAAC;UAC/BhB,UAAU;UACVE;QACF,CAAC,CAAC;QACFX,QAAQ,CAAC,IAAIwB,WAAW,EAAE,CAAC;MAC7B,CAAC,MAAM;QACLxB,QAAQ,CAAC,EAAE,CAAC;MACd;IACF;IAEAgB,SAAS,CAACO,OAAO,GAAG,IAAI;IAC1B;EACA,CAAC,EAAE,CAACd,UAAU,EAAEE,WAAW,CAAC,CAAC;EAE7B/B,KAAK,CAAC0C,SAAS,CAAC,MAAM;IACpB,IAAIJ,MAAM,CAACQ,QAAQ,CAACC,MAAM,EAAE;MAC1B,MAAMC,MAAM,GAAGrC,EAAE,CAACsC,KAAK,CAACX,MAAM,CAACQ,QAAQ,CAACC,MAAM,CAACG,SAAS,CAAC,CAAC,CAAC,CAAiC;MAE5F7B,QAAQ,CAACZ,UAAU,CAAC;QAClBoB,UAAU,EAAEsB,MAAM,CAACH,MAAM,CAACnB,UAAU,CAAC;QACrCE,WAAW,EAAEoB,MAAM,CAACH,MAAM,CAACjB,WAAW;MACxC,CAAC,CAAC,CAAC;MAEHK,SAAS,CAACO,OAAO,GAAG,IAAI;IAC1B;EACF,CAAC,EAAE,EAAE,CAAC;EAEN3C,KAAK,CAAC0C,SAAS,CAAC,MAAM;IACpBJ,MAAM,CAACC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC;IACrB,IAAI,CAACjB,QAAQ,CAACqB,OAAO,EAAE;MACrBN,SAAS,CAAC,CAAC;IACb;IAEA,IAAIC,MAAM,CAACQ,QAAQ,CAACC,MAAM,KAAK,EAAE,EAAE;MACjC1B,QAAQ,CAACd,aAAa,CAAC,CAAC,CAAC,CAAC;IAC5B;IAEAe,QAAQ,CAACqB,OAAO,GAAG,KAAK;EAC1B,CAAC,EAAE,CAACd,UAAU,EAAEC,IAAI,CAACsB,YAAY,EAAErB,WAAW,EAAEO,MAAM,CAACQ,QAAQ,CAACC,MAAM,CAAC,CAAC;EAExE,MAAMM,MAAM,GAAGnB,KAAK,CAACoB,MAAM,CAAEC,GAAc,IAAK;IAC9C,IAAIA,GAAG,CAACC,KAAK,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACzB,WAAW,CAACwB,WAAW,CAAC,CAAC,CAAC,EAAE;MAC/D,OAAO,IAAI;IACb;IAAC;IAED,OAAO,KAAK;EACd,CAAC,CAAC,CAACE,GAAG,CAAEJ,GAAc,iBAAKtC,OAAA,CAACd,UAAU;IAAA,GAAkBoD;EAAG,GAAfA,GAAG,CAAC3B,EAAE;IAAAgC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAY,CAAC,CAAC;EAEhE,MAAMC,SAAS,GAAG,CAAC,GAAG,IAAIC,KAAK,CAAClC,WAAW,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC4B,GAAG,CAAC,CAACO,CAAC,EAAEC,CAAC,kBAAKlD,OAAA,CAACb,QAAQ,MAAM+D,CAAC;IAAAP,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAG,CAAC,CAAC;EAE/F,oBACE9C,OAAA;IAAKmD,SAAS,EAAC,WAAW;IAAAC,QAAA,gBACxBpD,OAAA;MAAKmD,SAAS,EAAC,cAAc;MAAAC,QAAA,gBAC3BpD,OAAA,CAAChB,UAAU;QAACqE,KAAK,EAAIzC,UAAW;QAACL,gBAAgB,EAAEA;MAAiB;QAAAoC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eACvE9C,OAAA,CAACf,IAAI;QAACoE,KAAK,EAAIxC,IAAK;QAACH,YAAY,EAAIA;MAAa;QAAAiC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAClD,CAAC,eACN9C,OAAA;MAAImD,SAAS,EAAC,gBAAgB;MAAAC,QAAA,EAAC;IAAS;MAAAT,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,EAC5C5B,MAAM,KAAK,OAAO,gBACjBlB,OAAA;MAAKmD,SAAS,EAAC,qBAAqB;MAAAC,QAAA,gBAClCpD,OAAA;QAAAoD,QAAA,GAAI,6FAAgB,eAAApD,OAAA;UAAAoD,QAAA,EAAM;QAAE;UAAAT,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eACxC9C,OAAA;QAAAoD,QAAA,GAAG,+MACuC,eAAApD,OAAA;UAAA2C,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC,kMAEhD;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACD,CAAC,gBAEN9C,OAAA;MAAKmD,SAAS,EAAC,gBAAgB;MAAAC,QAAA,EAC5BlC,MAAM,KAAK,SAAS,GAAG6B,SAAS,GAAGX;IAAM;MAAAO,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACvC,CACN,eACD9C,OAAA,CAACZ,UAAU;MAACkE,SAAS,EAAEvC,UAAW;MAACD,WAAW,EAAEA;IAAY;MAAA6B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAC5D,CAAC;AAEV,CAAC;AAAA5C,EAAA,CA7GYD,IAAc;EAAA,QACRN,WAAW,EACXG,cAAc,EAaoCT,WAAW,EACpDA,WAAW;AAAA;AAAAkE,EAAA,GAhB1BtD,IAAc;AAAA,IAAAsD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}