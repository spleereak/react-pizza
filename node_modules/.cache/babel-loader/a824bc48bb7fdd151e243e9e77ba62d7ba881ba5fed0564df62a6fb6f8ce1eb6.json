{"ast":null,"code":"var _jsxFileName = \"/home/splee/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/react-pizza/src/pages/Home.tsx\",\n  _s = $RefreshSig$();\nimport React from 'react';\nimport { Categories } from '../components/Categories';\nimport { Sort } from '../components/Sort';\nimport { PizzaBlock } from '../components/PizzaBlock';\nimport { Skeleton } from '../components/PizzaBlock/Skeleton';\nimport { Pagination } from '../components/Pagination';\nimport { useSelector } from 'react-redux';\nimport { setCategoryId, setSortType, selectFilter } from '../redux/slices/filter/slice';\nimport qs from 'qs';\nimport { useNavigate } from 'react-router-dom';\nimport { fetchPizza, selectPizzaData } from '../redux/slices/pizza/slice';\nimport { useAppDispatch } from '../redux/store';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Home = () => {\n  _s();\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n  const isSearch = React.useRef(false);\n  const {\n    categoryId,\n    sort,\n    currentPage,\n    pagesCount,\n    searchValue\n  } = useSelector(selectFilter);\n  const {\n    items,\n    status\n  } = useSelector(selectPizzaData);\n  const isMounted = React.useRef(false);\n  const getPizzas = async () => {\n    try {\n      dispatch(fetchPizza({\n        currentPage,\n        sort,\n        categoryId\n      }));\n      window.scrollTo(0, 0);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  React.useEffect(() => {\n    if (isMounted.current) {\n      if (categoryId !== 0) {\n        const queryString = qs.stringify({\n          categoryId,\n          currentPage\n        });\n        navigate(`?${queryString}`);\n      } else {\n        navigate('');\n      }\n    }\n    isMounted.current = true;\n  }, [categoryId, currentPage]);\n\n  // React.useEffect(() => {\n  //   if (window.location.search) {\n  //     const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzaParams;\n\n  //     dispatch(setFilters({\n  //       categoryId: Number(params.categoryId),\n  //       currentPage: Number(params.currentPage)\n  //     }));\n\n  //     isMounted.current = true;\n  //   }\n  // }, []);\n\n  // React.useEffect(() => {\n  //   window.scrollTo(0, 0);    \n  //   if (!isSearch.current) {\n  //     getPizzas();\n  //   }\n\n  //   if (window.location.search === '') {\n  //     dispatch(setCategoryId(0))\n  //   }\n\n  //   isSearch.current = false;\n  // }, [categoryId, sort.sortProperty, currentPage, window.location.search]);\n\n  const pizzas = items.filter(obj => {\n    if (obj.title.toLowerCase().includes(searchValue.toLowerCase())) {\n      return true;\n    }\n    ;\n    return false;\n  }).map(obj => /*#__PURE__*/_jsxDEV(PizzaBlock, {\n    ...obj\n  }, obj.id, false, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 30\n  }, this));\n  const skeletons = [...new Array(currentPage === 3 ? 2 : 4)].map((_, i) => /*#__PURE__*/_jsxDEV(Skeleton, {}, i, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 77\n  }, this));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__top\",\n      children: [/*#__PURE__*/_jsxDEV(Categories, {\n        value: categoryId,\n        onChangeCategory: id => dispatch(setCategoryId(id))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Sort, {\n        value: sort,\n        onChangeSort: id => dispatch(setSortType(id))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"content__title\",\n      children: \"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this), status === 'error' ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__error-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: [\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430\", /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\uD83D\\uDE15\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 31\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E, \\u043D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u043F\\u0438\\u0446\\u0446\\u044B.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 53\n        }, this), \"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"content__items\",\n      children: status === 'loading' ? skeletons : pizzas\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Pagination, {\n      pageCount: pagesCount,\n      currentPage: currentPage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 5\n  }, this);\n};\n_s(Home, \"hTfeIae0MS6kLaEL6bEoIQYyy3o=\", false, function () {\n  return [useNavigate, useAppDispatch, useSelector, useSelector];\n});\n_c = Home;\nvar _c;\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"names":["React","Categories","Sort","PizzaBlock","Skeleton","Pagination","useSelector","setCategoryId","setSortType","selectFilter","qs","useNavigate","fetchPizza","selectPizzaData","useAppDispatch","jsxDEV","_jsxDEV","Home","_s","navigate","dispatch","isSearch","useRef","categoryId","sort","currentPage","pagesCount","searchValue","items","status","isMounted","getPizzas","window","scrollTo","err","console","log","useEffect","current","queryString","stringify","pizzas","filter","obj","title","toLowerCase","includes","map","id","fileName","_jsxFileName","lineNumber","columnNumber","skeletons","Array","_","i","className","children","value","onChangeCategory","onChangeSort","pageCount","_c","$RefreshReg$"],"sources":["/home/splee/Документы/react-pizza/src/pages/Home.tsx"],"sourcesContent":["import React from 'react';\nimport { Categories } from '../components/Categories';\nimport { Sort } from '../components/Sort';\nimport { PizzaBlock } from '../components/PizzaBlock';\nimport { Skeleton } from '../components/PizzaBlock/Skeleton';\nimport { Pagination } from '../components/Pagination';\nimport { useSelector } from 'react-redux';\nimport { setCategoryId, setSortType, setFilters, SearchPizzaParams, selectFilter } from '../redux/slices/filter/slice';\nimport qs from 'qs'\nimport { useNavigate } from 'react-router-dom';\nimport { fetchPizza, selectPizzaData } from '../redux/slices/pizza/slice';\nimport { useAppDispatch } from '../redux/store';\n\nexport type ItemProps = {\n  id: string,\n  title: string,\n  price: number,\n  imageUrl: string,\n  sizes: number[],\n  types: number[]\n}\n\nexport const Home: React.FC = () => {\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n  const isSearch = React.useRef(false);\n\n  const { categoryId, sort, currentPage, pagesCount, searchValue } = useSelector(selectFilter);\n  const { items, status } = useSelector(selectPizzaData);\n  const isMounted = React.useRef(false)\n\n  const getPizzas = async () => {\n    try {\n      dispatch(\n        fetchPizza({\n        currentPage,\n        sort,\n        categoryId\n      }))\n      window.scrollTo(0, 0);\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  React.useEffect(() => {    \n    if (isMounted.current) {\n      if (categoryId !== 0) {\n        const queryString = qs.stringify({\n          categoryId,\n          currentPage\n        });\n        navigate(`?${queryString}`);\n      } else {\n        navigate('')\n      }\n    }\n\n    isMounted.current = true\n  }, [categoryId, currentPage]);\n\n  // React.useEffect(() => {\n  //   if (window.location.search) {\n  //     const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzaParams;\n\n  //     dispatch(setFilters({\n  //       categoryId: Number(params.categoryId),\n  //       currentPage: Number(params.currentPage)\n  //     }));\n\n  //     isMounted.current = true;\n  //   }\n  // }, []);\n\n  // React.useEffect(() => {\n  //   window.scrollTo(0, 0);    \n  //   if (!isSearch.current) {\n  //     getPizzas();\n  //   }\n\n  //   if (window.location.search === '') {\n  //     dispatch(setCategoryId(0))\n  //   }\n\n  //   isSearch.current = false;\n  // }, [categoryId, sort.sortProperty, currentPage, window.location.search]);\n\n  const pizzas = items.filter((obj: ItemProps) => {\n    if (obj.title.toLowerCase().includes(searchValue.toLowerCase())) {\n      return true;\n    };\n\n    return false;\n  }).map((obj: ItemProps) => <PizzaBlock key={obj.id} {...obj} />);\n  \n  const skeletons = [...new Array(currentPage === 3 ? 2 : 4)].map((_, i) => <Skeleton key={i} />);  \n\n  return (\n    <div className='container'>\n      <div className=\"content__top\">\n        <Categories value = {categoryId} onChangeCategory={(id: number) => dispatch(setCategoryId(id))} />\n        <Sort value = {sort} onChangeSort={(id: {name: string, sortProperty: string}) => dispatch(setSortType(id))} />\n      </div>\n      <h2 className=\"content__title\">Все пиццы</h2>\n      {status === 'error' ? (\n        <div className='content__error-info'>\n          <h2>Произошла ошибка<span>😕</span></h2>\n          <p>\n            К сожалению, не удалось загрузить пиццы.<br />\n            Попробуйте повторить попытку позже.\n          </p>\n        </div>\n      ) : (\n        <div className=\"content__items\">\n          {status === 'loading' ? skeletons : pizzas}\n        </div>\n      )}\n      <Pagination pageCount={pagesCount} currentPage={currentPage} />\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}