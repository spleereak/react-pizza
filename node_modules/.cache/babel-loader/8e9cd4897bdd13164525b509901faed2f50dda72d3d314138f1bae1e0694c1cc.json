{"ast":null,"code":"import _objectSpread from\"/home/splee/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/react-pizza/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React from'react';import{Categories,Sort,PizzaBlock,Skeleton,Pagination}from'../components';import{useSelector}from'react-redux';import{setCategoryId,setSortType,setFilters}from'../redux/filter/slice';import{selectFilter}from'../redux/filter/selectors';import qs from'qs';import{useNavigate}from'react-router-dom';import{fetchPizza}from'../redux/pizza/asyncActions';import{selectPizzaData}from'../redux/pizza/selectors';import{useAppDispatch}from'../redux/store';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const Home=()=>{const navigate=useNavigate();const dispatch=useAppDispatch();const isSearch=React.useRef(false);const onChangeCategory=React.useCallback(idx=>{dispatch(setCategoryId(idx));},[]);const onChangeSort=React.useCallback(id=>{dispatch(setSortType(id));},[]);const{categoryId,sort,currentPage,pagesCount,searchValue}=useSelector(selectFilter);const{items,status}=useSelector(selectPizzaData);const isMounted=React.useRef(false);const getPizzas=async()=>{try{dispatch(fetchPizza({currentPage,sort,categoryId}));window.scrollTo(0,0);}catch(err){throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ API');}};React.useEffect(()=>{if(isMounted.current){if(categoryId!==0){const queryString=qs.stringify({categoryId,currentPage});navigate(\"?\".concat(queryString));}else{navigate('');}}isMounted.current=true;},[categoryId,currentPage]);React.useEffect(()=>{if(window.location.search){const params=qs.parse(window.location.search.substring(1));dispatch(setFilters({categoryId:Number(params.categoryId),currentPage:Number(params.currentPage)}));isMounted.current=true;}},[]);React.useEffect(()=>{window.scrollTo(0,0);if(!isSearch.current){getPizzas();}if(window.location.search===''){dispatch(setCategoryId(0));}isSearch.current=false;},[categoryId,sort.sortProperty,currentPage,window.location.search]);const pizzas=items.filter(obj=>{if(obj.title.toLowerCase().includes(searchValue.toLowerCase())){return true;};return false;}).map(obj=>/*#__PURE__*/_jsx(PizzaBlock,_objectSpread({},obj),obj.id));const skeletons=[...new Array(currentPage===3?2:4)].map((_,i)=>/*#__PURE__*/_jsx(Skeleton,{},i));return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{value:categoryId,onChangeCategory:onChangeCategory}),/*#__PURE__*/_jsx(Sort,{value:sort,onChangeSort:onChangeSort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),status==='error'?/*#__PURE__*/_jsxs(\"div\",{className:\"content__error-info\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430\",/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDE15\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041A \\u0441\\u043E\\u0436\\u0430\\u043B\\u0435\\u043D\\u0438\\u044E, \\u043D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u043F\\u0438\\u0446\\u0446\\u044B.\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435.\"]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:status==='loading'?skeletons:pizzas}),/*#__PURE__*/_jsx(Pagination,{pageCount:pagesCount,currentPage:currentPage})]});};","map":{"version":3,"names":["React","Categories","Sort","PizzaBlock","Skeleton","Pagination","useSelector","setCategoryId","setSortType","setFilters","selectFilter","qs","useNavigate","fetchPizza","selectPizzaData","useAppDispatch","jsx","_jsx","jsxs","_jsxs","Home","navigate","dispatch","isSearch","useRef","onChangeCategory","useCallback","idx","onChangeSort","id","categoryId","sort","currentPage","pagesCount","searchValue","items","status","isMounted","getPizzas","window","scrollTo","err","Error","useEffect","current","queryString","stringify","concat","location","search","params","parse","substring","Number","sortProperty","pizzas","filter","obj","title","toLowerCase","includes","map","_objectSpread","skeletons","Array","_","i","className","children","value","pageCount"],"sources":["/home/splee/–î–æ–∫—É–º–µ–Ω—Ç—ã/react-pizza/src/pages/Home.tsx"],"sourcesContent":["import React from 'react';\nimport { Categories, Sort, PizzaBlock, Skeleton, Pagination } from '../components';\nimport { useSelector } from 'react-redux';\nimport { setCategoryId, setSortType, setFilters } from '../redux/filter/slice';\nimport { selectFilter } from '../redux/filter/selectors'\nimport { SearchPizzaParams } from '../redux/filter/types'\nimport qs from 'qs'\nimport { useNavigate } from 'react-router-dom';\nimport { fetchPizza } from '../redux/pizza/asyncActions';\nimport { selectPizzaData } from '../redux/pizza/selectors';\nimport { useAppDispatch } from '../redux/store';\n\nexport type ItemProps = {\n  id: string,\n  title: string,\n  price: number,\n  imageUrl: string,\n  sizes: number[],\n  types: number[]\n}\n\nexport const Home: React.FC = () => {\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n  const isSearch = React.useRef(false);\n\n  const onChangeCategory = React.useCallback((idx: number) => {\n    dispatch(setCategoryId(idx))\n  }, [])\n\n  const onChangeSort = React.useCallback((id: { name: string, sortProperty: string }) => {\n    dispatch(setSortType(id))\n  }, [])\n\n  const { categoryId, sort, currentPage, pagesCount, searchValue } = useSelector(selectFilter);\n  const { items, status } = useSelector(selectPizzaData);\n  const isMounted = React.useRef(false)\n\n  const getPizzas = async () => {\n    try {\n      dispatch(\n        fetchPizza({\n        currentPage,\n        sort,\n        categoryId\n      }))\n      window.scrollTo(0, 0);\n    } catch (err) {\n      throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ API');\n    }\n  }\n\n  React.useEffect(() => {    \n    if (isMounted.current) {\n      if (categoryId !== 0) {\n        const queryString = qs.stringify({\n          categoryId,\n          currentPage\n        });\n        navigate(`?${queryString}`);\n      } else {\n        navigate('')\n      }\n    }\n\n    isMounted.current = true\n  }, [categoryId, currentPage]);\n\n  React.useEffect(() => {\n    if (window.location.search) {\n      const params = qs.parse(window.location.search.substring(1)) as unknown as SearchPizzaParams;\n\n      dispatch(setFilters({\n        categoryId: Number(params.categoryId),\n        currentPage: Number(params.currentPage)\n      }));\n\n      isMounted.current = true;\n    }\n  }, []);\n\n  React.useEffect(() => {\n    window.scrollTo(0, 0);    \n    if (!isSearch.current) {\n      getPizzas();\n    }\n\n    if (window.location.search === '') {\n      dispatch(setCategoryId(0))\n    }\n\n    isSearch.current = false;\n  }, [categoryId, sort.sortProperty, currentPage, window.location.search]);\n\n  const pizzas = items.filter((obj: ItemProps) => {\n    if (obj.title.toLowerCase().includes(searchValue.toLowerCase())) {\n      return true;\n    };\n\n    return false;\n  }).map((obj: ItemProps) => <PizzaBlock key={obj.id} {...obj} />);\n  \n  const skeletons = [...new Array(currentPage === 3 ? 2 : 4)].map((_, i) => <Skeleton key={i} />);  \n\n  return (\n    <div className='container'>\n      <div className=\"content__top\">\n        <Categories value = {categoryId} onChangeCategory={onChangeCategory} />\n        <Sort value = {sort} onChangeSort = {onChangeSort} />\n      </div>\n      <h2 className=\"content__title\">–í—Å–µ –ø–∏—Ü—Ü—ã</h2>\n      {status === 'error' ? (\n        <div className='content__error-info'>\n          <h2>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞<span>üòï</span></h2>\n          <p>\n            –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–∏—Ü—Ü—ã.<br />\n            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.\n          </p>\n        </div>\n      ) : (\n        <div className=\"content__items\">\n          {status === 'loading' ? skeletons : pizzas}\n        </div>\n      )}\n      <Pagination pageCount={pagesCount} currentPage={currentPage} />\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}